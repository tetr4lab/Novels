@inherits ItemListBase<Sheet>

@page "/book/{BookId:long?}"

<PageTitle>Book</PageTitle>

@if (DataSet.IsUnavailable) {
    <MudAlert Severity="Severity.Error" Elevation="3">Unable to connect to any of the specified database management hosts.</MudAlert>
} else if (!DataSet.IsReady || items is null) {
    <MudProgressCircular Indeterminate="true" />
} else if (items.Count > 0) {
    var book = DataSet.Books.Find (s => s.Id == CurrentBookId);
    <MudText>『@(book?.Title ?? "")』 @(book?.Author ?? "")</MudText>
    <MudSimpleTable>
        <thead>
            <tr>
                <th>#</th>
                <th>ChapterTitle</th>
                <th>ChapterSubTitle</th>
                <th>SheetTitle</th>
                <th>Url</th>
            </tr>
        </thead>
        @foreach (var item in items) {
            @if (FilterFunc (item)) {
                <tr>
                    <td>@(items.IndexOf (item) + 1)</td>
                    <td>@item.ChapterTitle</td>
                    <td>@item.ChapterSubTitle</td>
                    <td>@item.SheetTitle</td>
                    <td>@item.Url</td>
                </tr>
            }
        }
    </MudSimpleTable>
} else {
    <MudText>No items found.</MudText>
}
selected: @CurrentBookId

@code {
    /// <summary>指定された書籍</summary>
    [Parameter] public long? BookId { get; set; } = null;

    /// <summary>最初に着目書籍を切り替えてDataSetの再初期化を促す</summary>
    protected override async Task OnInitializedAsync() {
        DataSet.CurrentBookId = BookId ?? CurrentBookId;
        if (BookId is not null && BookId != CurrentBookId) {
            await SetCurrentBookId.InvokeAsync (BookId.Value);
        }
        await base.OnInitializedAsync ();
        await SetSectionTitle.InvokeAsync ($"BookId: {CurrentBookId}");
    }
}